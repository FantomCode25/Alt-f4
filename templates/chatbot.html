<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>HealthMate AI</title>

<style>

* { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
}

body { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    min-height: 100vh; 
    background: linear-gradient(135deg, #6e8efb, #a777e3); 
}

.chatbot-container { 
    width: 380px; 
    background-color: rgba(255, 255, 255, 0.95); 
    border-radius: 20px; 
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); 
    backdrop-filter: blur(10px); 
}

#header { 
    background: linear-gradient(135deg, #4a90e2, #7b68ee); 
    color: white; 
    padding: 20px; 
    border-radius: 20px 20px 0 0; 
    text-align: center; 
    font-size: 1.2em; 
}

#conversation { 
    height: 450px; 
    overflow-y: auto; 
    padding: 20px; 
    display: flex; 
    flex-direction: column; 
    gap: 15px; 
}

.chatbot-message { 
    max-width: 80%; 
    padding: 12px 16px; 
    border-radius: 18px; 
    font-size: 15px; 
    line-height: 1.4; 
    animation: fade-in 0.3s ease-out; 
}

.user-message { 
    align-self: flex-end; 
    background: linear-gradient(135deg, #4a90e2, #7b68ee); 
    color: white; 
    border-radius: 18px 18px 0 18px; 
}

.chatbot { 
    align-self: flex-start; 
    background: linear-gradient(135deg, #ff6b6b, #ff8e8e); 
    color: white; 
    border-radius: 18px 18px 18px 0; 
}

@keyframes fade-in { 
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    } 
    to { 
        opacity: 1; 
        transform: translateY(0); 
    } 
}

#input-form { 
    display: flex; 
    padding: 15px; 
    border-top: 1px solid rgba(0, 0, 0, 0.1); 
    background: rgba(255, 255, 255, 0.95); 
    border-radius: 0 0 20px 20px; 
}

#input-field { 
    flex: 1; 
    height: 46px; 
    border: 2px solid #e0e0e0; 
    padding: 0 15px; 
    font-size: 15px; 
    border-radius: 23px; 
    background: white; 
    color: #333; 
    transition: border-color 0.3s ease; 
}

#input-field:focus { 
    border-color: #4a90e2; 
    outline: none; 
}

#submit-button { 
    background: linear-gradient(135deg, #4a90e2, #7b68ee); 
    border: none; 
    color: white; 
    padding: 12px 24px; 
    margin-left: 10px; 
    border-radius: 23px; 
    cursor: pointer; 
    font-size: 15px; 
    transition: transform 0.2s ease; 
}

#submit-button:hover { 
    transform: scale(1.05); 
}

::-webkit-scrollbar { 
    width: 8px; 
}

::-webkit-scrollbar-track { 
    background: rgba(0, 0, 0, 0.05); 
    border-radius: 4px; 
}

::-webkit-scrollbar-thumb { 
    background: rgba(0, 0, 0, 0.2); 
    border-radius: 4px; 
}

::-webkit-scrollbar-thumb:hover { 
    background: rgba(0, 0, 0, 0.3); 
}
</style>

</head>

<body>

<div class="chatbot-container">

<div id="header">
    <h1> HealthMate AI</h1>
</div>

<div id="conversation">

<div class="chatbot-message chatbot">

<p>Hi! I'm your AI assistant üëã How can I help?</p>

</div>

</div>

<form id="input-form">

<input id="input-field" type="text" placeholder="Type your message...">

<button id="submit-button" type="submit">Send</button>

</form>

</div>

<script>

const GEMINI_API_KEY = "AIzaSyC8KBJ6ooV-2k1h_pvqFr2W13hsTL7DWvo";

const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`;

function displayMessage(message, sender) {
    let conversation = document.getElementById("conversation");
    let msgDiv = document.createElement("div");
    msgDiv.classList.add("chatbot-message", sender === "user" ? "user-message" : "chatbot");
    msgDiv.innerHTML = `<p>${message}</p>`;
    conversation.appendChild(msgDiv);
    conversation.scrollTop = conversation.scrollHeight;
}

const predefinedResponses = {
    "view records": "üîç Let's access your health records securely. Please choose what you'd like to view:\n1. Recent visits\n2. Lab results\n3. Prescriptions\n4. Vaccination history\nEnter the number of your choice.",
    
    "add record": "üìù I'll help you add a new medical record. What type would you like to add?\n1. Doctor Visit (includes date, doctor, diagnosis)\n2. Lab Results (includes test type, values, date)\n3. Prescription (includes medication, dosage, duration)\n4. Vaccination (includes vaccine type, date, batch number)\nSelect a number to continue.",
    
    "share records": "ü§ù Record sharing setup:\n1. Which healthcare provider needs access?\n- Your doctor's name\n- Hospital/Clinic name\n2. Access duration needed?\n- Temporary (specify days)\n- Permanent\nLet's start with the provider's name:",
    
    "weight loss": "‚öñÔ∏è Let's create your personalized weight loss journey:\n1. Current weight (kg)?\n2. Target weight (kg)?\n3. Weekly activity level?\n   - Sedentary (mostly sitting)\n   - Moderate (some exercise)\n   - Active (regular exercise)\n4. Any health conditions?\nStart with #1:",
    
    "weight gain": "üí™ Let's build your muscle gain program:\n1. Current weight (kg)?\n2. Target weight (kg)?\n3. Exercise experience?\n   - Beginner (< 1 year)\n   - Intermediate (1-3 years)\n   - Advanced (3+ years)\n4. Training preference?\n   - Home workouts\n   - Gym access\nStart with #1:",
    
    "diabetes care": "ü©∫ For personalized diabetes management:\n1. Current blood sugar level?\n   - Fasting\n   - Post-meal\n2. Are you on medication?\n   - Type of medication\n   - Dosage\n3. Recent A1C level?\n4. Diet preferences?\nLet's begin with your blood sugar level:",
    
    "bp control": "‚ù§Ô∏è For better blood pressure management:\n1. Recent BP readings?\n   - Systolic (top number)\n   - Diastolic (bottom number)\n2. Current medications?\n3. Daily salt intake?\n   - Low (< 1500mg)\n   - Medium (1500-2300mg)\n   - High (> 2300mg)\nStart with your BP reading:",
    
    "daily exercise": "üéØ Custom workout planning:\n1. Your main goal?\n   - Weight management\n   - Muscle building\n   - Cardiovascular health\n   - Overall fitness\n2. Available time per day?\n3. Preferred workout type?\n   - Home exercises\n   - Outdoor activities\n   - Gym training\nLet's start with your goal:",
    
    "diet plan": "ü•ó Personalized nutrition planning:\n1. Any dietary restrictions?\n   - Vegetarian/Vegan\n   - Gluten-free\n   - Dairy-free\n   - None\n2. Daily meal preference?\n   - 3 main meals\n   - 5-6 smaller meals\n3. Any food allergies?\nStart with your dietary restrictions:",
    
    "help": "‚ÑπÔ∏è Available commands:\nüìã Health Records:\n- view records\n- add record\n- share records\n\nüí™ Fitness & Nutrition:\n- weight loss\n- weight gain\n- daily exercise\n- diet plan\n\nüè• Health Management:\n- diabetes care\n- bp control\n\nType any command to begin!"
};

// Add a new object to track conversation states
const conversationState = {
    currentCommand: null,
    step: 0,
    answers: {}
};

function handlePredefinedResponse(userInput) {
    if (predefinedResponses[userInput.toLowerCase()]) {
        conversationState.currentCommand = userInput.toLowerCase();
        conversationState.step = 1;
        conversationState.answers = {};
        return predefinedResponses[userInput.toLowerCase()];
    }
    
    if (conversationState.currentCommand) {
        conversationState.answers[conversationState.step] = userInput;
        
        switch (conversationState.currentCommand) {
            case "weight loss":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Great! Now please provide #2: Your target weight (kg)?";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "Last question: Any health conditions we should consider?";
                } else if (conversationState.step === 3) {
                    const plan = generateWeightLossPlan(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
            case "weight gain":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Great! Now please provide #2: Your target weight (kg)?";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "Last question: What's your exercise experience (beginner/intermediate/advanced)?";
                } else if (conversationState.step === 3) {
                    const plan = generateWeightGainPlan(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
            case "add record":
                if (conversationState.step === 1) {
                    const recordType = parseInt(userInput);
                    if (recordType === 1) {
                        conversationState.recordType = "Doctor Visit";
                        conversationState.step++;
                        return "Please enter the date of visit (DD/MM/YYYY):";
                    } else if (recordType === 2) {
                        conversationState.recordType = "Lab Results";
                        conversationState.step++;
                        return "Please enter the date of test (DD/MM/YYYY):";
                    } else if (recordType === 3) {
                        conversationState.recordType = "Prescription";
                        conversationState.step++;
                        return "Please enter the prescription date (DD/MM/YYYY):";
                    } else if (recordType === 4) {
                        conversationState.recordType = "Vaccination";
                        conversationState.step++;
                        return "Please enter the vaccination date (DD/MM/YYYY):";
                    }
                    return "Please select a valid option (1-4):";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    switch(conversationState.recordType) {
                        case "Doctor Visit":
                            return "Enter doctor's name:";
                        case "Lab Results":
                            return "Enter test type (e.g., Blood Test, X-Ray):";
                        case "Prescription":
                            return "Enter medication name:";
                        case "Vaccination":
                            return "Enter vaccine name:";
                    }
                } else if (conversationState.step === 3) {
                    conversationState.step++;
                    switch(conversationState.recordType) {
                        case "Doctor Visit":
                            return "Enter diagnosis/reason for visit:";
                        case "Lab Results":
                            return "Enter test results/values:";
                        case "Prescription":
                            return "Enter dosage (e.g., 500mg twice daily):";
                        case "Vaccination":
                            return "Enter batch number:";
                    }
                } else if (conversationState.step === 4) {
                    const record = generateMedicalRecord(conversationState.recordType, conversationState.answers);
                    conversationState.currentCommand = null;
                    return record;
                }
                break;
            case "view records":
                if (conversationState.step === 1) {
                    const viewType = parseInt(userInput);
                    if (viewType >= 1 && viewType <= 4) {
                        const record = generateViewRecord(viewType);
                        conversationState.currentCommand = null;
                        return record;
                    }
                    return "Please select a valid option (1-4):";
                }
                break;
            case "diabetes care":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Thank you. Are you currently taking any diabetes medication? If yes, please specify the type and dosage:";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "What was your most recent A1C level?";
                } else if (conversationState.step === 3) {
                    conversationState.step++;
                    return "Last question: Do you have any dietary preferences or restrictions?";
                } else if (conversationState.step === 4) {
                    const plan = generateDiabetesCareAdvice(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
            case "bp control":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Are you currently taking any blood pressure medications? If yes, please specify:";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "What is your daily salt intake? (low/medium/high):";
                } else if (conversationState.step === 3) {
                    const plan = generateBPControlAdvice(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
            case "daily exercise":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Great! How much time can you dedicate to exercise per day (in minutes)?";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "Last question: What's your preferred workout type (home/outdoor/gym)?";
                } else if (conversationState.step === 3) {
                    const plan = generateExercisePlan(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
            case "diet plan":
                if (conversationState.step === 1) {
                    conversationState.step++;
                    return "Great! Now for #2: What's your daily meal preference (3 main meals or 5-6 smaller meals)?";
                } else if (conversationState.step === 2) {
                    conversationState.step++;
                    return "Last question: Do you have any food allergies? If none, type 'none'.";
                } else if (conversationState.step === 3) {
                    const plan = generateDietPlan(conversationState.answers);
                    conversationState.currentCommand = null;
                    return plan;
                }
                break;
        }
    }
    return null;
}

// Move generateDietPlan function outside of handlePredefinedResponse
function generateDietPlan(answers) {
    const dietaryRestriction = answers[1].toLowerCase();
    const mealPreference = answers[2].toLowerCase();
    const allergies = answers[3].toLowerCase();
    
    let plan = `ü•ó Your Personalized Nutrition Plan:\n\n`;
    plan += `Dietary Type: ${dietaryRestriction}\n`;
    plan += `Meal Schedule: ${mealPreference}\n`;
    plan += `Allergies: ${allergies}\n\n`;
    
    plan += `üìã Daily Nutrition Guidelines:\n`;
    plan += `- Protein: Plant-based sources (legumes, tofu, tempeh)\n`;
    plan += `- Carbs: Whole grains, fruits, vegetables\n`;
    plan += `- Fats: Nuts, seeds, avocado\n`;
    plan += `- Iron: Leafy greens, fortified cereals\n`;
    plan += `- B12: Fortified foods or supplements\n\n`;
    
    if (mealPreference.includes('3')) {
        plan += `üïí Meal Schedule:\n`;
        plan += `- Breakfast (7-9 AM): Hearty meal with protein\n`;
        plan += `- Lunch (12-2 PM): Balanced main meal\n`;
        plan += `- Dinner (6-8 PM): Light but nutritious\n`;
    } else {
        plan += `üïí Meal Schedule:\n`;
        plan += `- Early breakfast (7 AM)\n`;
        plan += `- Mid-morning snack (10 AM)\n`;
        plan += `- Lunch (1 PM)\n`;
        plan += `- Afternoon snack (4 PM)\n`;
        plan += `- Dinner (7 PM)\n`;
        plan += `- Optional evening snack (9 PM)\n`;
    }
    
    plan += `\nüí° Tips:\n`;
    plan += `- Stay hydrated (8-10 glasses of water)\n`;
    plan += `- Include variety of colors in meals\n`;
    plan += `- Plan meals in advance\n`;
    plan += `- Read food labels carefully\n`;
    
    if (allergies !== 'none') {
        plan += `\n‚ö†Ô∏è Important: Always check food labels for ${allergies} content.`;
    }
    
    return plan;
}

// Add this new function after other generate functions
function generateBPControlAdvice(answers) {
    const bpReading = answers[1];
    const medications = answers[2];
    const saltIntake = answers[3].toLowerCase();
    
    let [systolic, diastolic] = bpReading.split('/').map(num => parseInt(num.trim()));
    
    let advice = `‚ù§Ô∏è Your Blood Pressure Management Plan:\n\n`;
    advice += `üìä Current BP: ${systolic}/${diastolic} mmHg\n`;
    
    // BP Category Assessment
    if (systolic >= 180 || diastolic >= 120) {
        advice += `‚ö†Ô∏è HYPERTENSIVE CRISIS - Seek emergency care immediately!\n\n`;
    } else if (systolic >= 140 || diastolic >= 90) {
        advice += `‚ö†Ô∏è Your blood pressure is high. Consult your healthcare provider.\n\n`;
    } else if (systolic >= 120 || diastolic >= 80) {
        advice += `‚ö° Your blood pressure is elevated. Let's work on lifestyle changes.\n\n`;
    } else {
        advice += `‚úÖ Your blood pressure is in the normal range.\n\n`;
    }
    
    advice += `üíä Current Medications: ${medications}\n`;
    advice += `üßÇ Salt Intake Level: ${saltIntake}\n\n`;
    
    advice += `Recommendations:\n`;
    advice += `- Monitor BP regularly\n`;
    
    // Salt intake specific recommendations
    if (saltIntake === 'high') {
        advice += `‚ö†Ô∏è High Salt Intake Recommendations:\n`;
        advice += `- Reduce salt intake to less than 1500mg/day\n`;
        advice += `- Read food labels for sodium content\n`;
        advice += `- Cook meals at home to control salt\n`;
        advice += `- Use herbs and spices instead of salt\n`;
    } else if (saltIntake === 'medium') {
        advice += `üìù Moderate Salt Intake Recommendations:\n`;
        advice += `- Maintain current salt intake below 2300mg/day\n`;
        advice += `- Be mindful of hidden sodium in processed foods\n`;
        advice += `- Balance salt with potassium-rich foods\n`;
    } else {
        advice += `‚úÖ Low Salt Intake Recommendations:\n`;
        advice += `- Continue maintaining low salt diet\n`;
        advice += `- Monitor for any symptoms of low sodium\n`;
        advice += `- Ensure adequate mineral intake\n`;
    }
    
    // General recommendations
    advice += `\nGeneral Lifestyle Recommendations:\n`;
    advice += `- Exercise 30 minutes daily\n`;
    advice += `- Practice stress management techniques\n`;
    advice += `- Limit alcohol consumption\n`;
    advice += `- Maintain healthy weight\n`;
    advice += `- Get adequate sleep (7-8 hours)\n`;
    
    if (!medications.toLowerCase().includes('no')) {
        advice += `- Take medications as prescribed\n`;
    }
    
    if (systolic >= 140 || diastolic >= 90) {
        advice += `\n‚ö†Ô∏è Important: Schedule a follow-up with your healthcare provider.`;
    }
    
    return advice;
}

// Add this new function after generateMedicalRecord
function generateDiabetesCareAdvice(answers) {
    const bloodSugar = answers[1];
    const medication = answers[2];
    const a1c = answers[3];
    const diet = answers[4];
    
    let advice = `ü©∫ Your Personalized Diabetes Management Plan:\n\n`;
    
    // Blood sugar analysis
    advice += `üìä Current Blood Sugar: ${bloodSugar} mg/dL\n`;
    if (bloodSugar > 180) {
        advice += `‚ö†Ô∏è Your blood sugar appears elevated. Consider immediate consultation.\n`;
    }
    
    // Medication info
    advice += `üíä Medication Status: ${medication}\n`;
    
    // A1C information
    advice += `üî¨ A1C Level: ${a1c}%\n`;
    
    // Diet preferences
    advice += `ü•ó Dietary Considerations: ${diet}\n\n`;
    
    advice += `Recommendations:\n`;
    advice += `- Monitor blood sugar levels regularly\n`;
    advice += `- Keep a food and medication diary\n`;
    advice += `- Exercise moderately for 30 minutes daily\n`;
    advice += `- Stay hydrated\n`;
    advice += `- Schedule regular check-ups\n\n`;
    
    if (bloodSugar > 180 || parseFloat(a1c) > 7) {
        advice += `‚ö†Ô∏è Important: Please consult your healthcare provider soon for medication adjustment.`;
    }
    
    return advice;
}

// Add this new function after generateMedicalRecord
function generateViewRecord(viewType) {
    const mockRecords = {
        1: `üìã Recent Doctor Visits:\n
- 15/03/2024: Dr. Smith - Regular Checkup
- 28/02/2024: Dr. Johnson - Flu Symptoms
- 10/01/2024: Dr. Davis - Annual Physical\n
To view detailed information about a visit, use "view visit" command followed by the date.`,

        2: `üî¨ Recent Lab Results:\n
- 15/03/2024: Complete Blood Count - Normal
- 28/02/2024: Lipid Panel - Slightly Elevated
- 10/01/2024: Thyroid Function - Normal\n
For detailed results, use "view lab" command followed by the date.`,

        3: `üíä Current Prescriptions:\n
- Amoxicillin 500mg - 3x daily (ends 20/03/2024)
- Vitamin D3 - 1x daily (ongoing)
- Ibuprofen 400mg - As needed\n
For prescription details, use "view prescription" command followed by the medication name.`,

        4: `üíâ Vaccination History:\n
- COVID-19 Booster (10/01/2024)
- Flu Shot (15/09/2023)
- Tetanus (05/03/2023)\n
For vaccination details, use "view vaccination" command followed by the vaccine name.`
    };

    return mockRecords[viewType] || "No records found for this category.";
}

function generateMedicalRecord(type, answers) {
    const date = answers[2];
    const detail1 = answers[3];
    const detail2 = answers[4];
    
    let recordSummary = `‚úÖ ${type} Record Added Successfully!\n\n`;
    recordSummary += `üìÖ Date: ${date}\n`;
    
    switch(type) {
        case "Doctor Visit":
            recordSummary += `üë®‚Äç‚öïÔ∏è Doctor: ${detail1}\n`;
            recordSummary += `üìã Diagnosis: ${detail2}`;
            break;
        case "Lab Results":
            recordSummary += `üî¨ Test Type: ${detail1}\n`;
            recordSummary += `üìä Results: ${detail2}`;
            break;
        case "Prescription":
            recordSummary += `üíä Medication: ${detail1}\n`;
            recordSummary += `üìù Dosage: ${detail2}`;
            break;
        case "Vaccination":
            recordSummary += `üíâ Vaccine: ${detail1}\n`;
            recordSummary += `üî¢ Batch Number: ${detail2}`;
            break;
    }
    
    return recordSummary + "\n\nRecord has been saved to your health profile.";
}

function generateWeightGainPlan(answers) {
    const currentWeight = parseFloat(answers[1]);
    const targetWeight = parseFloat(answers[2]);
    const experience = answers[3].toLowerCase();
    
    const workoutIntensity = {
        'beginner': '3 times per week',
        'intermediate': '4-5 times per week',
        'advanced': '5-6 times per week'
    };
    
    return `üí™ Your Personalized Muscle Gain Program:\n
- Current: ${currentWeight}kg ‚Üí Target: ${targetWeight}kg
- Workout Frequency: ${workoutIntensity[experience] || '3-4 times per week'}
- Progressive overload training
- Daily Protein: ${Math.round(currentWeight * 2)}g
- Caloric surplus: 300-500 calories/day
- Rest: 7-8 hours daily
- Track progress weekly\n
Recommended Exercises:
- Compound movements (Squats, Deadlifts, Bench Press)
- Progressive overload principle
- ${experience === 'beginner' ? 'Focus on form and technique' : 
   experience === 'intermediate' ? 'Include isolation exercises' : 
   'Advanced training splits and periodization'}`;
}

function generateWeightLossPlan(answers) {
    const currentWeight = parseFloat(answers[1]);
    const targetWeight = parseFloat(answers[2]);
    const healthConditions = answers[3];
    
    return `üèÉ‚Äç‚ôÇÔ∏è Your Personalized Weight Loss Plan:\n
- Current: ${currentWeight}kg ‚Üí Target: ${targetWeight}kg
- Recommended weekly loss: 0.5-1kg
- Exercise: 45 mins cardio (${healthConditions.toLowerCase().includes('joint') ? 'swimming/cycling' : 'walking/jogging'})
- Diet: High protein, low carb meals
- Caloric deficit: 500 calories/day
- Track progress weekly
${healthConditions ? '\nNote: Considering your ' + healthConditions + ', please consult your doctor before starting this plan.' : ''}`;
}

// Add this function before sendMessage
function generateExercisePlan(answers) {
    const goal = answers[1].toLowerCase();
    const timeAvailable = parseInt(answers[2]);
    const workoutType = answers[3].toLowerCase();
    
    let plan = `üéØ Your Personalized Exercise Plan:\n\n`;
    plan += `Goal: ${goal}\n`;
    plan += `Time Available: ${timeAvailable} minutes/day\n`;
    plan += `Preferred Setting: ${workoutType} workouts\n\n`;
    
    // Goal-specific recommendations
    if (goal.includes('weight management')) {
        plan += `üìã Recommended Routine:\n`;
        plan += `- 10 mins warm-up\n`;
        plan += `- 20-30 mins cardio (jumping jacks, high knees, burpees)\n`;
        plan += `- 15-20 mins strength training\n`;
        plan += `- 5 mins cool-down\n\n`;
        plan += `üéØ Target Heart Rate: 60-70% of max\n`;
    }
    
    // Home-specific exercises
    plan += `üí™ Exercise Examples:\n`;
    plan += `- Bodyweight squats: 3 sets x 15 reps\n`;
    plan += `- Push-ups: 3 sets x 10 reps\n`;
    plan += `- Planks: 3 sets x 30 seconds\n`;
    plan += `- Mountain climbers: 3 sets x 30 seconds\n`;
    plan += `- Lunges: 3 sets x 12 reps per leg\n`;
    
    plan += `\nüìù Weekly Schedule:\n`;
    plan += `- Exercise: 4-5 days/week\n`;
    plan += `- Rest: 2-3 days/week\n`;
    plan += `- Gradually increase intensity\n`;
    
    return plan;
}

// Update sendMessage function
function sendMessage() {
    let userInput = document.getElementById("input-field").value.trim();
    if (!userInput) return;

    displayMessage(userInput, "user");
    document.getElementById("input-field").value = "";

    const response = handlePredefinedResponse(userInput);
    if (response) {
        displayMessage(response, "bot");
        saveChatHistory(userInput, response);
        return;
    }

    fetch(API_URL, {
        method: "POST",
        headers: { 
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            contents: [{
                parts: [{
                    text: userInput
                }]
            }],
            generationConfig: {
                temperature: 0.9,
                topK: 1,
                topP: 1
            }
        })
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => {
                console.error('API Error:', err);
                throw new Error(err.error?.message || 'API request failed');
            });
        }
        return response.json();
    })
    .then(data => {
        let botReply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't understand that. Could you rephrase?";
        displayMessage(botReply, "bot");
        saveChatHistory(userInput, botReply);
    })
    .catch(error => {
        console.error('Error:', error);
        displayMessage("I'm having trouble connecting. Please try using predefined commands like 'help'.", "bot");
        saveChatHistory(userInput, "API error");
    });
}

document.addEventListener("DOMContentLoaded", () => loadChatHistory());

document.getElementById("input-form").addEventListener("submit", function(event) {

event.preventDefault();

sendMessage();

});

function saveChatHistory(userMessage, botReply) {

let history = JSON.parse(localStorage.getItem("chatHistory")) || [];

history.push({ sender: "user", message: userMessage });

history.push({ sender: "bot", message: botReply });

localStorage.setItem("chatHistory", JSON.stringify(history));

}

function loadChatHistory() {
    // Clear existing chat history from localStorage
    localStorage.removeItem("chatHistory");
    
    // Clear the conversation div except for the initial greeting
    const conversation = document.getElementById("conversation");
    conversation.innerHTML = `
        <div class="chatbot-message chatbot">
            <p>Hi! I'm your AI assistant üëã How can I help?</p>
        </div>
    `;
}

</script>

</body>

</html>